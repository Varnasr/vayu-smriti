<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vayu Smriti वायु स्मृति | India's Air Quality Archive</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --primary: #7C3AED; --primary-light: #A78BFA; --accent: #F59E0B;
            --text: #1F2937; --text-2: #4B5563; --text-3: #9CA3AF;
            --bg: #F8FAFC; --card: #FFFFFF; --border: #E2E8F0;
            --health: #EF4444; --policy: #3B82F6; --research: #10B981;
            --aqi-good: #22C55E; --aqi-mod: #EAB308; --aqi-poor: #F97316; 
            --aqi-vpoor: #EF4444; --aqi-severe: #7C3AED; --aqi-hazard: #831843;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        [data-theme="dark"] {
            --text: #F1F5F9; --text-2: #CBD5E1; --text-3: #64748B;
            --bg: #0F172A; --card: #1E293B; --border: #334155;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', system-ui, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; font-size: 14px; }
        
        /* HEADER */
        .header { background: var(--card); border-bottom: 1px solid var(--border); padding: 0.5rem 1rem; position: sticky; top: 0; z-index: 1000; }
        .header-inner { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem; }
        .logo { display: flex; align-items: center; gap: 0.5rem; }
        .logo-mark { width: 32px; height: 32px; background: var(--gradient); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .logo-mark svg { width: 18px; height: 18px; stroke: white; fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }
        .logo h1 { font-size: 1rem; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .header-actions { display: flex; gap: 0.5rem; align-items: center; }
        .btn { padding: 0.375rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 500; cursor: pointer; border: none; font-family: inherit; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.25rem; }
        .btn svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 1.5; }
        .btn-icon { padding: 0.375rem; background: transparent; border: 1px solid var(--border); color: var(--text-2); }
        .btn-icon:hover { border-color: var(--primary); color: var(--primary); }
        .btn-primary { background: var(--gradient); color: white; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.6875rem; }

        /* TICKER - FIXED LAYOUT */
        .ticker { background: linear-gradient(90deg, #1E293B, #0F172A); padding: 0.375rem 1rem; }
        .ticker-row { max-width: 1400px; margin: 0 auto; display: flex; align-items: center; gap: 0.75rem; }
        .ticker-label { font-size: 0.625rem; text-transform: uppercase; letter-spacing: 1px; color: #94A3B8; display: flex; align-items: center; gap: 0.25rem; flex-shrink: 0; }
        .pulse { width: 6px; height: 6px; background: #EF4444; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .ticker-scroll { display: flex; gap: 0.5rem; flex: 1; overflow-x: auto; padding: 0.125rem 0; -webkit-overflow-scrolling: touch; }
        .ticker-scroll::-webkit-scrollbar { height: 3px; }
        .ticker-scroll::-webkit-scrollbar-track { background: #334155; }
        .ticker-scroll::-webkit-scrollbar-thumb { background: #64748B; border-radius: 3px; }
        .ticker-item { display: flex; align-items: center; gap: 0.25rem; flex-shrink: 0; }
        .ticker-city { font-size: 0.625rem; color: #94A3B8; white-space: nowrap; }
        .ticker-aqi { font-size: 0.6875rem; font-weight: 700; padding: 0.125rem 0.375rem; border-radius: 3px; min-width: 32px; text-align: center; color: white; }
        .ticker-aqi.good { background: var(--aqi-good); } 
        .ticker-aqi.mod { background: var(--aqi-mod); color: #1F2937; }
        .ticker-aqi.poor { background: var(--aqi-poor); } 
        .ticker-aqi.vpoor { background: var(--aqi-vpoor); } 
        .ticker-aqi.severe { background: var(--aqi-severe); } 
        .ticker-aqi.hazard { background: var(--aqi-hazard); }
        .ticker-meta { display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0; }
        .ticker-refresh { background: #475569; color: #E2E8F0; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.625rem; cursor: pointer; display: flex; align-items: center; gap: 0.25rem; }
        .ticker-refresh:hover { background: #64748B; }
        .ticker-refresh svg { width: 12px; height: 12px; stroke: currentColor; }
        .ticker-time { font-size: 0.5625rem; color: #64748B; white-space: nowrap; }

        /* TABS */
        .tabs { background: var(--card); border-bottom: 1px solid var(--border); padding: 0 1rem; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .tabs::-webkit-scrollbar { display: none; }
        .tabs-inner { max-width: 1400px; margin: 0 auto; display: flex; gap: 0.25rem; }
        .tab { padding: 0.75rem 0.875rem; font-size: 0.75rem; font-weight: 500; color: var(--text-2); cursor: pointer; border-bottom: 2px solid transparent; white-space: nowrap; display: flex; align-items: center; gap: 0.375rem; transition: all 0.2s; }
        .tab svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 1.5; }
        .tab:hover { color: var(--text); }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* MAIN */
        .main { max-width: 1400px; margin: 0 auto; padding: 1rem; }
        .panel { display: none; }
        .panel.active { display: block; }

        /* GRID LAYOUTS */
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .grid-5 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.75rem; }
        @media (max-width: 1100px) { .grid-4, .grid-5 { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .grid-2, .grid-3, .grid-4, .grid-5 { grid-template-columns: 1fr; } }

        /* CARDS */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .card-header { padding: 0.75rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 0.8125rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        .card-title svg { width: 16px; height: 16px; stroke: var(--primary); fill: none; stroke-width: 1.5; }
        .card-body { padding: 0.75rem; }
        .card-footer { padding: 0.5rem 0.75rem; border-top: 1px solid var(--border); background: var(--bg); font-size: 0.6875rem; color: var(--text-3); }

        /* STAT CARDS */
        .stat-card { text-align: center; padding: 1rem; }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary); line-height: 1.2; }
        .stat-value.danger { color: var(--health); }
        .stat-value.warning { color: var(--accent); }
        .stat-value.success { color: var(--research); }
        .stat-label { font-size: 0.625rem; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 0.25rem; }
        .stat-change { font-size: 0.625rem; margin-top: 0.25rem; }

        /* SECTION INTRO */
        .section-intro { background: linear-gradient(135deg, rgba(124,58,237,0.05), rgba(167,139,250,0.05)); border: 1px solid rgba(124,58,237,0.1); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
        .section-intro h2 { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--primary); }
        .section-intro p { font-size: 0.8125rem; color: var(--text-2); line-height: 1.6; }

        /* SEARCH BOX */
        .search-box { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .search-input { flex: 1; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: 6px; font-size: 0.875rem; background: var(--card); color: var(--text); }
        .search-input:focus { outline: none; border-color: var(--primary); }
        .search-btn { padding: 0.5rem 1rem; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.75rem; }

        /* ALERT BOX */
        .alert { padding: 0.75rem; border-radius: 6px; font-size: 0.75rem; display: flex; align-items: flex-start; gap: 0.5rem; }
        .alert svg { width: 16px; height: 16px; flex-shrink: 0; margin-top: 0.125rem; }
        .alert-danger { background: #FEE2E2; border: 1px solid #FECACA; color: #991B1B; }
        .alert-danger svg { stroke: #EF4444; }
        .alert-warning { background: #FEF3C7; border: 1px solid #FDE68A; color: #92400E; }
        .alert-warning svg { stroke: #F59E0B; }
        .alert-info { background: #DBEAFE; border: 1px solid #BFDBFE; color: #1E40AF; }
        .alert-info svg { stroke: #3B82F6; }

        /* QUICK LINKS */
        .quick-link { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 6px; background: var(--bg); border: 1px solid var(--border); cursor: pointer; transition: all 0.2s; }
        .quick-link:hover { border-color: var(--primary); transform: translateY(-2px); }
        .quick-link-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .quick-link-icon svg { width: 20px; height: 20px; stroke: white; fill: none; stroke-width: 1.5; }
        .quick-link-icon.health { background: linear-gradient(135deg, #EF4444, #F97316); }
        .quick-link-icon.economic { background: linear-gradient(135deg, #F59E0B, #EAB308); }
        .quick-link-icon.policy { background: linear-gradient(135deg, #3B82F6, #6366F1); }
        .quick-link-icon.tools { background: linear-gradient(135deg, #10B981, #14B8A6); }
        .quick-link-content h4 { font-size: 0.8125rem; font-weight: 600; }
        .quick-link-content p { font-size: 0.6875rem; color: var(--text-3); }

        /* FORMS */
        .form-group { margin-bottom: 0.75rem; }
        .form-label { display: block; font-size: 0.6875rem; font-weight: 500; color: var(--text-2); margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .form-input, .form-select { width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; font-size: 0.875rem; background: var(--card); color: var(--text); font-family: inherit; }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--primary); }
        .form-range { width: 100%; }
        .form-hint { font-size: 0.625rem; color: var(--text-3); margin-top: 0.25rem; }

        /* TABLES */
        .table-wrap { overflow-x: auto; }
        .table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
        .table th, .table td { padding: 0.5rem; text-align: left; border-bottom: 1px solid var(--border); }
        .table th { font-weight: 600; color: var(--text-2); text-transform: uppercase; font-size: 0.625rem; letter-spacing: 0.5px; background: var(--bg); position: sticky; top: 0; }
        .table tr:hover { background: var(--bg); }

        /* BADGES */
        .badge { display: inline-block; padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.625rem; font-weight: 600; text-transform: uppercase; }
        .badge-success { background: #D1FAE5; color: #065F46; }
        .badge-warning { background: #FEF3C7; color: #92400E; }
        .badge-danger { background: #FEE2E2; color: #991B1B; }
        .badge-info { background: #DBEAFE; color: #1E40AF; }

        /* RESULT BOX */
        .result-box { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-top: 1rem; }
        .result-title { font-size: 0.6875rem; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem; }
        .result-value { font-size: 1.5rem; font-weight: 700; }
        .result-detail { font-size: 0.75rem; color: var(--text-2); margin-top: 0.5rem; }

        /* INFO BOX */
        .info-box { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
        .info-box h4 { font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text); }
        .info-box p, .info-box li { font-size: 0.75rem; color: var(--text-2); line-height: 1.6; }
        .info-box ul { margin-left: 1rem; margin-top: 0.5rem; }
        .info-box li { margin-bottom: 0.25rem; }

        /* RESOURCE CARD */
        .resource-card { padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; transition: all 0.2s; margin-bottom: 0.5rem; }
        .resource-card:hover { border-color: var(--primary); background: rgba(124,58,237,0.02); }
        .resource-card a { text-decoration: none; color: inherit; display: block; }
        .resource-type { font-size: 0.5625rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-3); margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.5rem; }
        .resource-type .badge { font-size: 0.5rem; }
        .resource-title { font-size: 0.8125rem; font-weight: 500; color: var(--primary); margin-bottom: 0.25rem; }
        .resource-desc { font-size: 0.6875rem; color: var(--text-2); line-height: 1.4; }
        .resource-meta { font-size: 0.5625rem; color: var(--text-3); margin-top: 0.375rem; }

        /* CITIZEN VOICE CARD */
        .voice-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 0.75rem; }
        .voice-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
        .voice-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--gradient); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; font-weight: 600; }
        .voice-name { font-size: 0.75rem; font-weight: 600; }
        .voice-handle { font-size: 0.625rem; color: var(--text-3); }
        .voice-content { font-size: 0.8125rem; line-height: 1.5; margin-bottom: 0.5rem; }
        .voice-content img { max-width: 100%; border-radius: 6px; margin-top: 0.5rem; }
        .voice-meta { font-size: 0.625rem; color: var(--text-3); display: flex; gap: 1rem; }
        .voice-source { display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.125rem 0.375rem; background: var(--bg); border-radius: 4px; font-size: 0.5625rem; }

        /* CODE BOX */
        .code-box { background: #1E293B; color: #E2E8F0; padding: 1rem; border-radius: 6px; font-family: 'SF Mono', Monaco, monospace; font-size: 0.6875rem; overflow-x: auto; white-space: pre-wrap; word-break: break-all; }

        /* MAP */
        #india-map { height: 450px; border-radius: 8px; }

        /* CHART */
        .chart-container { height: 250px; }

        /* TIMELINE */
        .timeline-item { display: flex; gap: 0.75rem; padding: 0.75rem 0; border-bottom: 1px solid var(--border); }
        .timeline-item:last-child { border-bottom: none; }
        .timeline-date { font-size: 0.625rem; color: var(--text-3); min-width: 60px; flex-shrink: 0; }
        .timeline-content { flex: 1; }
        .timeline-title { font-size: 0.8125rem; font-weight: 500; }
        .timeline-desc { font-size: 0.6875rem; color: var(--text-2); margin-top: 0.125rem; }

        /* TOOL CARD */
        .tool-card { border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .tool-header { background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(167,139,250,0.05)); padding: 1rem; border-bottom: 1px solid var(--border); }
        .tool-header h3 { font-size: 0.9375rem; font-weight: 600; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.5rem; }
        .tool-header h3 svg { width: 18px; height: 18px; stroke: var(--primary); }
        .tool-header p { font-size: 0.75rem; color: var(--text-2); }
        .tool-meta { display: flex; gap: 1rem; margin-top: 0.75rem; flex-wrap: wrap; }
        .tool-meta-item { font-size: 0.6875rem; color: var(--text-3); display: flex; align-items: center; gap: 0.25rem; }
        .tool-meta-item svg { width: 12px; height: 12px; stroke: var(--text-3); }
        .tool-body { padding: 1rem; background: var(--card); }

        /* GRAP STATUS */
        .grap-status { display: flex; gap: 0.25rem; }
        .grap-stage { padding: 0.375rem 0.5rem; font-size: 0.625rem; font-weight: 600; text-align: center; flex: 1; }
        .grap-stage.active { color: white; }
        .grap-1 { background: #D1FAE5; color: #065F46; }
        .grap-1.active { background: #10B981; }
        .grap-2 { background: #FEF3C7; color: #92400E; }
        .grap-2.active { background: #F59E0B; }
        .grap-3 { background: #FED7AA; color: #9A3412; }
        .grap-3.active { background: #F97316; }
        .grap-4 { background: #FEE2E2; color: #991B1B; }
        .grap-4.active { background: #EF4444; }

        /* CITY RANKING */
        .city-rank { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0; border-bottom: 1px solid var(--border); }
        .city-rank:last-child { border-bottom: none; }
        .rank-num { width: 20px; height: 20px; border-radius: 50%; background: var(--bg); font-size: 0.625rem; font-weight: 600; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .rank-num.top { background: var(--health); color: white; }
        .city-rank-name { flex: 1; font-size: 0.75rem; }
        .city-rank-aqi { font-size: 0.75rem; font-weight: 600; padding: 0.125rem 0.5rem; border-radius: 4px; color: white; }

        /* NEWS ITEM */
        .news-item { padding: 0.75rem 0; border-bottom: 1px solid var(--border); }
        .news-item:last-child { border-bottom: none; }
        .news-meta { font-size: 0.625rem; color: var(--text-3); margin-bottom: 0.25rem; display: flex; gap: 0.5rem; align-items: center; }
        .news-source { background: var(--bg); padding: 0.125rem 0.375rem; border-radius: 3px; }
        .news-title { font-size: 0.8125rem; font-weight: 500; color: var(--text); line-height: 1.4; }
        .news-title a { color: inherit; text-decoration: none; }
        .news-title a:hover { color: var(--primary); }

        /* FOOTER */
        .footer { background: var(--card); border-top: 1px solid var(--border); padding: 1rem; margin-top: 2rem; text-align: center; font-size: 0.75rem; color: var(--text-2); }

        /* UTILITIES */
        .text-center { text-align: center; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .flex { display: flex; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .flex-wrap { flex-wrap: wrap; }

        @media (max-width: 768px) {
            .hide-mobile { display: none; }
            .stat-value { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <div class="logo">
                <div class="logo-mark">
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                </div>
                <h1>Vayu Smriti वायु स्मृति</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-icon" onclick="toggleTheme()" title="Toggle theme">
                    <svg viewBox="0 0 24 24" width="16" height="16"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </button>
                <button class="btn btn-icon" onclick="exportData('json')" title="Export JSON">
                    <svg viewBox="0 0 24 24" width="16" height="16"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- FIXED TICKER -->
    <div class="ticker">
        <div class="ticker-row">
            <div class="ticker-label"><span class="pulse"></span> LIVE</div>
            <div class="ticker-scroll" id="aqi-ticker">
                <div class="ticker-item"><span class="ticker-city">Connecting...</span></div>
            </div>
            <div class="ticker-meta">
                <button class="ticker-refresh" onclick="fetchAllAQI()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                    Refresh
                </button>
                <span class="ticker-time" id="ticker-update">--:--</span>
            </div>
        </div>
    </div>

    <!-- TABS -->
    <nav class="tabs">
        <div class="tabs-inner">
            <div class="tab active" onclick="showPanel('dashboard')">
                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                Dashboard
            </div>
            <div class="tab" onclick="showPanel('health')">
                <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                Health
            </div>
            <div class="tab" onclick="showPanel('economic')">
                <svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                Economic
            </div>
            <div class="tab" onclick="showPanel('policy')">
                <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                Policy
            </div>
            <div class="tab" onclick="showPanel('compare')">
                <svg viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                Compare
            </div>
            <div class="tab" onclick="showPanel('map')">
                <svg viewBox="0 0 24 24"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>
                Map
            </div>
            <div class="tab" onclick="showPanel('trends')">
                <svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                Trends
            </div>
            <div class="tab" onclick="showPanel('accountability')">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
                Accountability
            </div>
            <div class="tab" onclick="showPanel('voices')">
                <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                Voices
            </div>
            <div class="tab" onclick="showPanel('tools')">
                <svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
                Tools
            </div>
            <div class="tab" onclick="showPanel('resources')">
                <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                Resources
            </div>
            <div class="tab" onclick="showPanel('about')">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                About
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main">

        <!-- ========== DASHBOARD ========== -->
        <div class="panel active" id="panel-dashboard">
            <div class="alert alert-info mb-2" id="live-status-bar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                <div id="live-status"><span class="pulse"></span> LIVE — Connecting to WAQI API...</div>
            </div>

            <div class="alert alert-danger mb-2" id="grap-alert">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                <div>
                    <strong>GRAP Stage IV Active in Delhi-NCR</strong> — Truck entry banned, 50% WFH advisory, construction stopped.
                </div>
            </div>

            <div class="grid-5 mb-2">
                <div class="card stat-card">
                    <div class="stat-value danger" id="delhi-live-aqi">--</div>
                    <div class="stat-label">Delhi Live AQI</div>
                    <div class="stat-change" id="delhi-aqi-status">Loading...</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value danger">2.1M</div>
                    <div class="stat-label">Deaths/Year India</div>
                    <div class="stat-change">Lancet 2019</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value warning">5.4%</div>
                    <div class="stat-label">GDP Loss</div>
                    <div class="stat-change">Rs 4.2L Cr/yr</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value danger">0</div>
                    <div class="stat-label">Good AQI Days Delhi</div>
                    <div class="stat-change">Jan-Dec 2025</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="worst-city-aqi">--</div>
                    <div class="stat-label" id="worst-city-name">Worst City</div>
                    <div class="stat-change">Right now</div>
                </div>
            </div>

            <div class="card mb-2">
                <div class="card-header">
                    <span class="card-title">
                        <svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg>
                        Delhi-NCR GRAP Status
                    </span>
                </div>
                <div class="card-body">
                    <div class="grap-status" id="grap-display">
                        <div class="grap-stage grap-1">Stage I<br><span style="font-size:0.5rem">201-300</span></div>
                        <div class="grap-stage grap-2">Stage II<br><span style="font-size:0.5rem">301-400</span></div>
                        <div class="grap-stage grap-3">Stage III<br><span style="font-size:0.5rem">401-450</span></div>
                        <div class="grap-stage grap-4 active">Stage IV<br><span style="font-size:0.5rem">450+</span></div>
                    </div>
                </div>
            </div>

            <div class="grid-3 mb-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">Worst Cities Now</span></div>
                    <div class="card-body" id="worst-cities"><div style="color: var(--text-3); font-size: 0.75rem;">Loading...</div></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">Best Cities Now</span></div>
                    <div class="card-body" id="best-cities"><div style="color: var(--text-3); font-size: 0.75rem;">Loading...</div></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Latest Updates</span>
                        <a href="#" onclick="showPanel('voices'); return false;" style="font-size: 0.625rem; color: var(--primary);">View all</a>
                    </div>
                    <div class="card-body" id="dashboard-news"><div style="color: var(--text-3); font-size: 0.75rem;">Loading...</div></div>
                </div>
            </div>

            <div class="grid-2 mb-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">Metro Cities AQI (Live)</span></div>
                    <div class="card-body"><div class="chart-container"><canvas id="metroChart"></canvas></div></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">North vs South India</span></div>
                    <div class="card-body"><div class="chart-container"><canvas id="regionChart"></canvas></div></div>
                </div>
            </div>

            <div class="grid-4">
                <div class="quick-link" onclick="showPanel('health')">
                    <div class="quick-link-icon health"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></div>
                    <div class="quick-link-content"><h4>Health Calculator</h4><p>Calculate your personal risk</p></div>
                </div>
                <div class="quick-link" onclick="showPanel('economic')">
                    <div class="quick-link-icon economic"><svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
                    <div class="quick-link-content"><h4>Economic Impact</h4><p>Business productivity loss</p></div>
                </div>
                <div class="quick-link" onclick="showPanel('accountability')">
                    <div class="quick-link-icon policy"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></div>
                    <div class="quick-link-content"><h4>Accountability</h4><p>RTI templates & tracking</p></div>
                </div>
                <div class="quick-link" onclick="showPanel('voices')">
                    <div class="quick-link-icon tools"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg></div>
                    <div class="quick-link-content"><h4>Citizen Voices</h4><p>Public response & action</p></div>
                </div>
            </div>
        </div>

        <!-- ========== HEALTH CALCULATOR ========== -->
        <div class="panel" id="panel-health">
            <div class="section-intro">
                <h2>Personal Health Risk Calculator</h2>
                <p>Estimate your health risk from air pollution using Global Exposure Mortality Model (GEMM) from GBD 2019.</p>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">Your Exposure Profile</span></div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Your Age</label>
                            <input type="number" class="form-input" id="health-age" value="35" min="1" max="100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Annual Average PM2.5 Exposure (ug/m3)</label>
                            <input type="number" class="form-input" id="health-pm25" value="100" min="0" max="500">
                            <div class="form-hint">Delhi avg: 100+ | WHO limit: 5 | India NAAQS: 40</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Hours Outdoors Daily: <span id="outdoor-display">4</span></label>
                            <input type="range" class="form-range" id="health-outdoor" min="0" max="12" value="4">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pre-existing Conditions</label>
                            <select class="form-select" id="health-conditions">
                                <option value="1">None</option>
                                <option value="1.3">Asthma</option>
                                <option value="1.5">COPD</option>
                                <option value="1.4">Cardiovascular Disease</option>
                                <option value="1.6">Multiple Conditions</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="calculateHealthRisk()">Calculate Risk</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header"><span class="card-title">Your Results</span></div>
                    <div class="card-body">
                        <div class="result-box">
                            <div class="result-title">Estimated Excess Mortality Risk</div>
                            <div class="result-value danger" id="mortality-risk">--</div>
                            <div class="result-detail">Compared to WHO guideline (5 ug/m3)</div>
                        </div>
                        <div class="result-box mt-1">
                            <div class="result-title">Estimated Life-Years Lost</div>
                            <div class="result-value warning" id="life-years-lost">--</div>
                        </div>
                        <div class="result-box mt-1">
                            <div class="result-title">Equivalent Cigarettes/Day</div>
                            <div class="result-value" id="cigarette-equiv">--</div>
                            <div class="result-detail">Berkeley Earth methodology</div>
                        </div>
                    </div>
                    <div class="card-footer">Sources: Lancet GBD 2019, IHME, Berkeley Earth</div>
                </div>
            </div>

            <div class="card mt-2">
                <div class="card-header"><span class="card-title">Safe Outdoor Hours Calculator</span></div>
                <div class="card-body">
                    <div class="grid-3">
                        <div class="form-group">
                            <label class="form-label">Current AQI</label>
                            <input type="number" class="form-input" id="safe-aqi" value="285" min="0" max="999">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Activity Level</label>
                            <select class="form-select" id="safe-activity">
                                <option value="1">Light (walking)</option>
                                <option value="2" selected>Moderate (cycling)</option>
                                <option value="3">Heavy (running)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Health Status</label>
                            <select class="form-select" id="safe-health">
                                <option value="1" selected>Healthy Adult</option>
                                <option value="1.5">Sensitive</option>
                                <option value="2">High Risk</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateSafeHours()">Calculate</button>
                    <div class="result-box" id="safe-result" style="display: none;">
                        <div class="result-title">Recommended Maximum Outdoor Time</div>
                        <div class="result-value" id="safe-hours">--</div>
                        <div class="result-detail" id="safe-advice"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== ECONOMIC IMPACT ========== -->
        <div class="panel" id="panel-economic">
            <div class="section-intro">
                <h2>Economic Cost of Air Pollution</h2>
                <p>Air pollution costs India an estimated 5.4% of GDP annually through healthcare, lost productivity, and premature deaths.</p>
            </div>

            <div class="grid-4 mb-2">
                <div class="card stat-card"><div class="stat-value warning">5.4%</div><div class="stat-label">GDP Loss</div></div>
                <div class="card stat-card"><div class="stat-value warning">Rs 4.2L Cr</div><div class="stat-label">Annual Cost</div></div>
                <div class="card stat-card"><div class="stat-value danger">1.36B</div><div class="stat-label">Workdays Lost</div></div>
                <div class="card stat-card"><div class="stat-value warning">Rs 1.7L Cr</div><div class="stat-label">Healthcare</div></div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">Business Productivity Loss Calculator</span></div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Number of Employees</label>
                            <input type="number" class="form-input" id="econ-employees" value="100" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Average Monthly Salary (Rs)</label>
                            <input type="number" class="form-input" id="econ-salary" value="50000" min="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">City</label>
                            <select class="form-select" id="econ-city">
                                <option value="delhi">Delhi</option>
                                <option value="mumbai">Mumbai</option>
                                <option value="kolkata">Kolkata</option>
                                <option value="chennai">Chennai</option>
                                <option value="bangalore">Bengaluru</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="calculateEconomicLoss()">Calculate Annual Loss</button>
                        <div class="result-box mt-2" id="econ-result" style="display: none;">
                            <div class="result-title">Estimated Annual Productivity Loss</div>
                            <div class="result-value warning" id="econ-loss">--</div>
                            <div class="result-detail" id="econ-detail"></div>
                        </div>
                    </div>
                    <div class="card-footer">Based on World Bank methodology</div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">Economic Impact by Sector</span></div>
                    <div class="card-body"><div class="chart-container"><canvas id="econChart"></canvas></div></div>
                </div>
            </div>
        </div>

        <!-- ========== POLICY TRACKER ========== -->
        <div class="panel" id="panel-policy">
            <div class="section-intro">
                <h2>Policy Effectiveness Tracker</h2>
                <p>Evaluating major air quality interventions by actual PM2.5 impact, evidence quality, and cost-effectiveness.</p>
            </div>

            <div class="card mb-2">
                <div class="card-body">
                    <div class="table-wrap">
                        <table class="table">
                            <thead><tr><th>Intervention</th><th>Years</th><th>PM2.5 Impact</th><th>Evidence</th><th>Cost-Effectiveness</th></tr></thead>
                            <tbody>
                                <tr><td><strong>Odd-Even Scheme</strong></td><td>2016, 2019</td><td><span class="badge badge-warning">-2% to -4%</span></td><td><span class="badge badge-warning">Weak</span></td><td>Low</td></tr>
                                <tr><td><strong>BS-VI Fuel Standards</strong></td><td>2020-</td><td><span class="badge badge-success">-10% to -15%</span></td><td><span class="badge badge-success">Strong</span></td><td>High</td></tr>
                                <tr><td><strong>GRAP Stage IV</strong></td><td>2024-25</td><td><span class="badge badge-success">-15% to -20%</span></td><td><span class="badge badge-warning">Moderate</span></td><td>Medium</td></tr>
                                <tr><td><strong>CNG Transition</strong></td><td>2001-</td><td><span class="badge badge-success">-25%</span></td><td><span class="badge badge-success">Strong</span></td><td>Very High</td></tr>
                                <tr><td><strong>Stubble Burning Bans</strong></td><td>2015-</td><td><span class="badge badge-danger">No change</span></td><td><span class="badge badge-success">Strong</span></td><td>Very Low</td></tr>
                                <tr><td><strong>Smog Towers</strong></td><td>2021-</td><td><span class="badge badge-danger">Negligible</span></td><td><span class="badge badge-success">Strong</span></td><td>Very Low</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer">Sources: IIT Delhi, TERI, CSE, CPCB evaluation reports</div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">NCAP Fund Utilization</span></div>
                    <div class="card-body"><div class="chart-container"><canvas id="ncapChart"></canvas></div></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">GRAP Stages Explained</span></div>
                    <div class="card-body" style="font-size: 0.75rem;">
                        <div style="padding: 0.5rem; background: #D1FAE5; border-radius: 4px; margin-bottom: 0.5rem;"><strong>Stage I (201-300):</strong> Water sprinkling, dust control</div>
                        <div style="padding: 0.5rem; background: #FEF3C7; border-radius: 4px; margin-bottom: 0.5rem;"><strong>Stage II (301-400):</strong> DG set ban, parking fees 4x</div>
                        <div style="padding: 0.5rem; background: #FED7AA; border-radius: 4px; margin-bottom: 0.5rem;"><strong>Stage III (401-450):</strong> Construction ban, mining ban</div>
                        <div style="padding: 0.5rem; background: #FEE2E2; border-radius: 4px;"><strong>Stage IV (450+):</strong> Truck entry ban, 50% WFH</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== CITY COMPARISON ========== -->
        <div class="panel" id="panel-compare">
            <div class="section-intro">
                <h2>Live City Comparison</h2>
                <p>Compare air quality across Indian cities and with international benchmarks. Data refreshes every 10 minutes from WAQI API.</p>
            </div>

            <div class="alert alert-info mb-2">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                <div><strong>Live Data:</strong> Fetching real-time AQI from monitoring stations. Last update: <span id="compare-update-time">--</span></div>
            </div>

            <div class="card mb-2">
                <div class="card-body">
                    <div class="grid-3 mb-2">
                        <div class="form-group">
                            <label class="form-label">Indian City 1</label>
                            <select class="form-select" id="compare-city1" onchange="updateComparison()">
                                <option value="delhi">Delhi</option>
                                <option value="mumbai">Mumbai</option>
                                <option value="kolkata">Kolkata</option>
                                <option value="chennai">Chennai</option>
                                <option value="bangalore">Bengaluru</option>
                                <option value="hyderabad">Hyderabad</option>
                                <option value="lucknow">Lucknow</option>
                                <option value="patna">Patna</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Indian City 2</label>
                            <select class="form-select" id="compare-city2" onchange="updateComparison()">
                                <option value="delhi">Delhi</option>
                                <option value="mumbai" selected>Mumbai</option>
                                <option value="kolkata">Kolkata</option>
                                <option value="chennai">Chennai</option>
                                <option value="bangalore">Bengaluru</option>
                                <option value="hyderabad">Hyderabad</option>
                                <option value="lucknow">Lucknow</option>
                                <option value="patna">Patna</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">International Benchmark</label>
                            <select class="form-select" id="compare-city3" onchange="updateComparison()">
                                <option value="beijing">Beijing (China)</option>
                                <option value="london">London (UK)</option>
                                <option value="singapore">Singapore</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary mb-2" onclick="updateComparison(true)">
                        <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                        Refresh Live Data
                    </button>
                    <div id="comparison-result" class="grid-3">
                        <div class="card stat-card"><div class="stat-value">--</div><div class="stat-label">Loading...</div></div>
                        <div class="card stat-card"><div class="stat-value">--</div><div class="stat-label">Loading...</div></div>
                        <div class="card stat-card"><div class="stat-value">--</div><div class="stat-label">Loading...</div></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Live AQI Comparison</span>
                    <span style="font-size: 0.625rem; color: var(--text-3);">Higher = Worse Air Quality</span>
                </div>
                <div class="card-body"><div class="chart-container"><canvas id="compareChart"></canvas></div></div>
                <div class="card-footer">WHO considers AQI &gt;50 unhealthy. Most Indian cities exceed this year-round.</div>
            </div>
        </div>

        <!-- ========== MAP ========== -->
        <div class="panel" id="panel-map">
            <div class="section-intro">
                <h2>Live Air Quality Map</h2>
                <p>Real-time AQI for major Indian cities from WAQI API. Click markers for PM2.5, station name, and update time.</p>
            </div>
            <div class="alert alert-info mb-2">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                <div style="flex: 1;"><strong>Live Data:</strong> Map markers show real-time AQI. Marker size indicates severity. Auto-refreshes every 10 minutes.</div>
                <button class="btn btn-sm btn-primary" onclick="fetchAllAQI()">Refresh Now</button>
            </div>
            <div class="card">
                <div class="card-body" style="padding: 0;"><div id="india-map"></div></div>
                <div class="card-footer">Data from WAQI API (aqicn.org). Covers CPCB and SPCB monitoring stations. Click any marker for details.</div>
            </div>
        </div>

        <!-- ========== TRENDS ========== -->
        <div class="panel" id="panel-trends">
            <div class="section-intro">
                <h2>Historical Trends</h2>
                <p>Delhi's air quality shows strong seasonal patterns with winter months consistently worst.</p>
            </div>
            <div class="card mb-2">
                <div class="card-header"><span class="card-title">Delhi PM2.5 Trend (2015-2025)</span></div>
                <div class="card-body"><div class="chart-container" style="height: 300px;"><canvas id="historyChart"></canvas></div></div>
            </div>
            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">Seasonal Pattern</span></div>
                    <div class="card-body"><div class="chart-container"><canvas id="seasonalChart"></canvas></div></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">Key Events</span></div>
                    <div class="card-body">
                        <div class="timeline-item"><div class="timeline-date">Nov 2016</div><div class="timeline-content"><div class="timeline-title">Great Smog of Delhi</div><div class="timeline-desc">AQI crossed 999. Schools closed.</div></div></div>
                        <div class="timeline-item"><div class="timeline-date">Apr 2020</div><div class="timeline-content"><div class="timeline-title">COVID Lockdown</div><div class="timeline-desc">PM2.5 dropped 50%+. Blue skies.</div></div></div>
                        <div class="timeline-item"><div class="timeline-date">Nov 2023</div><div class="timeline-content"><div class="timeline-title">Post-Diwali Peak</div><div class="timeline-desc">AQI 500+ for 5 days.</div></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== ACCOUNTABILITY ========== -->
        <div class="panel" id="panel-accountability">
            <div class="section-intro">
                <h2>Political Accountability Tracker</h2>
                <p>Tracking promises, court orders, and outcomes. Use RTI to demand transparency.</p>
            </div>

            <div class="card mb-2">
                <div class="card-header"><span class="card-title">Promises vs Reality</span></div>
                <div class="card-body">
                    <div class="table-wrap">
                        <table class="table">
                            <thead><tr><th>Statement/Promise</th><th>By Whom</th><th>Date</th><th>Status</th></tr></thead>
                            <tbody>
                                <tr><td>"Delhi's air will be clean within 3 years"</td><td>Delhi CM</td><td>2020</td><td><span class="badge badge-danger">Failed</span></td></tr>
                                <tr><td>"40% PM2.5 reduction by 2026"</td><td>MoEFCC</td><td>2019</td><td><span class="badge badge-warning">Behind</span></td></tr>
                                <tr><td>"Stubble burning will end this year"</td><td>Punjab CM</td><td>2021-24</td><td><span class="badge badge-danger">Repeated Failure</span></td></tr>
                                <tr><td>"Smog towers will solve pollution"</td><td>DPCC</td><td>2021</td><td><span class="badge badge-danger">Ineffective</span></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- RTI GUIDE - COMPREHENSIVE -->
            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">RTI Filing Guide</span></div>
                    <div class="card-body">
                        <div class="info-box">
                            <h4>What is RTI?</h4>
                            <p>The Right to Information Act 2005 gives every Indian citizen the right to request information from government bodies. Use it to demand air quality data, fund utilization details, and action reports.</p>
                        </div>
                        
                        <div class="info-box">
                            <h4>Where to File</h4>
                            <ul>
                                <li><strong>CPCB</strong> (Central Pollution Control Board) — National air quality data, NCAP funds</li>
                                <li><strong>DPCC</strong> (Delhi Pollution Control Committee) — Delhi-specific data</li>
                                <li><strong>State PCBs</strong> — State-level pollution data</li>
                                <li><strong>MoEFCC</strong> — Policy decisions, national programs</li>
                                <li><strong>CAQM</strong> — Delhi-NCR GRAP implementation</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <h4>How to File</h4>
                            <ul>
                                <li><strong>Online:</strong> <a href="https://rtionline.gov.in" target="_blank" style="color: var(--primary);">rtionline.gov.in</a> (Rs 10 fee)</li>
                                <li><strong>By Post:</strong> Send to CPIO of relevant department with Rs 10 postal order</li>
                                <li><strong>Response Time:</strong> 30 days (can extend to 45 days)</li>
                                <li><strong>Appeals:</strong> First Appeal within 30 days, then CIC</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <h4>Key Addresses</h4>
                            <p style="margin-bottom: 0.5rem;"><strong>CPCB:</strong> Parivesh Bhawan, East Arjun Nagar, Delhi-110032</p>
                            <p style="margin-bottom: 0.5rem;"><strong>DPCC:</strong> 4th Floor, ISBT Building, Kashmere Gate, Delhi-110006</p>
                            <p><strong>MoEFCC:</strong> Indira Paryavaran Bhawan, Jor Bagh Road, New Delhi-110003</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header"><span class="card-title">RTI Template</span></div>
                    <div class="card-body">
                        <p style="font-size: 0.75rem; color: var(--text-2); margin-bottom: 0.5rem;">Copy and customize this template:</p>
                        <div class="code-box" id="rti-template">To,
The Central Public Information Officer (CPIO)
[CPCB / DPCC / MoEFCC / State PCB]
[Full Address - see guide]

Subject: Application under RTI Act, 2005

Sir/Madam,

I request the following information under 
the Right to Information Act, 2005:

1. Total NCAP funds allocated to [city name] 
   in FY 2024-25 and utilization percentage

2. Station-wise PM2.5 and PM10 data for all 
   monitoring stations in [city] for [month/year]

3. Number of challans issued under GRAP 
   violations from [date] to [date]

4. Action Taken Report on industrial units 
   violating emission norms in [area]

5. Minutes of last 3 CAQM/EPCA meetings

I am depositing Rs 10/- as application fee 
[via online portal / postal order no. ___]

Applicant Details:
Name: [Your Full Name]
Address: [Your Address]
Phone: [Your Number]
Email: [Your Email]

Date: [Today's Date]
Place: [Your City]

Signature: _______________</div>
                        <button class="btn btn-primary mt-1" onclick="copyRTI()">Copy Template</button>
                        <a href="https://rtionline.gov.in" target="_blank" class="btn btn-primary mt-1" style="margin-left: 0.5rem;">File Online</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== CITIZEN VOICES ========== -->
        <div class="panel" id="panel-voices">
            <div class="section-intro">
                <h2>Citizen Voices & Public Response</h2>
                <p>Real reactions from citizens, journalists, and activists documenting Delhi's air crisis. These voices drive accountability.</p>
            </div>

            <div class="grid-2">
                <div>
                    <div class="voice-card">
                        <div class="voice-header">
                            <div class="voice-avatar">JG</div>
                            <div>
                                <div class="voice-name">Jyoti Ghosh</div>
                                <div class="voice-handle">@jyotighosh_econ</div>
                            </div>
                            <span class="voice-source">X/Twitter</span>
                        </div>
                        <div class="voice-content">
                            "My 6-year-old asked why the sky is white and not blue. How do I explain that we've normalized a public health emergency? AQI 450 and schools are open. This is criminal negligence."
                        </div>
                        <div class="voice-meta">Nov 2024 | 12.4K likes | 3.2K retweets</div>
                    </div>

                    <div class="voice-card">
                        <div class="voice-header">
                            <div class="voice-avatar">RK</div>
                            <div>
                                <div class="voice-name">Rohit Kumar</div>
                                <div class="voice-handle">@rohit_delhi</div>
                            </div>
                            <span class="voice-source">X/Twitter</span>
                        </div>
                        <div class="voice-content">
                            "Day 5 of AQI above 500. My N95 mask ran out. Local shops sold out. Amazon delivering in 3 days. Meanwhile, politicians are debating whose fault it is. We are literally choking while they play politics."
                        </div>
                        <div class="voice-meta">Nov 2024 | 8.7K likes</div>
                    </div>

                    <div class="voice-card">
                        <div class="voice-header">
                            <div class="voice-avatar">AP</div>
                            <div>
                                <div class="voice-name">Dr. Arvind Patel</div>
                                <div class="voice-handle">Pulmonologist, AIIMS</div>
                            </div>
                            <span class="voice-source">Interview</span>
                        </div>
                        <div class="voice-content">
                            "In November, my OPD is 80% respiratory cases. Children, elderly, even healthy young adults with persistent cough. This is not normal. We are witnessing a slow-motion public health disaster that repeats every year."
                        </div>
                        <div class="voice-meta">The Hindu, Dec 2024</div>
                    </div>

                    <div class="voice-card">
                        <div class="voice-header">
                            <div class="voice-avatar">SM</div>
                            <div>
                                <div class="voice-name">Sunita Mishra</div>
                                <div class="voice-handle">Auto-rickshaw driver</div>
                            </div>
                            <span class="voice-source">Street Interview</span>
                        </div>
                        <div class="voice-content">
                            "Sahab, mask lagane se meri kamai kam ho jaati hai, log darr jaate hain. Aur na lagaun toh raat ko khanssi itni aati hai ki neend nahi. Kya karein? Kaam bhi zaroori hai, sehat bhi."
                            <br><em style="font-size: 0.75rem; color: var(--text-3);">"If I wear a mask, passengers get scared and I lose income. If I don't, I cough all night. What choice do I have?"</em>
                        </div>
                        <div class="voice-meta">CSE Field Survey, Nov 2024</div>
                    </div>
                </div>

                <div>
                    <div class="voice-card">
                        <div class="voice-header">
                            <div class="voice-avatar">VB</div>
                            <div>
                                <div class="voice-name">Vimlendu Jha</div>
                                <div class="voice-handle">@swaboramedia</div>
                            </div>
                            <span class="voice-source">X/Twitter</span>
                        </div>
                        <div class="voice-content">
                            "Every year same script: AQI spikes, blame game between Delhi-Punjab-Haryana-Centre, emergency measures for 2 weeks, everyone forgets till next November. When will we break this cycle? 20 years of promises, zero structural solutions."
                        </div>
                        <div class="voice-meta">Nov 2024 | Founder, Swechha</div>
                    </div>

                    <div class="voice-card">
                        <div class="voice-header">
                            <div class="voice-avatar">PS</div>
                            <div>
                                <div class="voice-name">Punjab Farmer</div>
                                <div class="voice-handle">Anonymous</div>
                            </div>
                            <span class="voice-source">Field Report</span>
                        </div>
                        <div class="voice-content">
                            "Happy Seeder costs Rs 1.5 lakh. I earn Rs 80,000/year. Government subsidy is Rs 50,000 but takes 2 years to come. I have 15 days to clear field for wheat. What option do I have except burning? You solve my problem, I'll stop burning."
                        </div>
                        <div class="voice-meta">Down To Earth, Oct 2024</div>
                    </div>

                    <div class="voice-card" style="background: linear-gradient(135deg, rgba(239,68,68,0.05), rgba(249,115,22,0.05)); border-color: rgba(239,68,68,0.2);">
                        <div class="voice-header">
                            <div class="voice-avatar" style="background: #EF4444;">SC</div>
                            <div>
                                <div class="voice-name">Supreme Court of India</div>
                                <div class="voice-handle">Bench: CJI + 2 Judges</div>
                            </div>
                            <span class="voice-source">Court Order</span>
                        </div>
                        <div class="voice-content">
                            "People are dying and you are doing nothing. This is not a matter of statistics, this is about right to life under Article 21. How long will you take to implement what has been ordered for years? We are tired of passing orders that remain on paper."
                        </div>
                        <div class="voice-meta">SC hearing on Delhi air pollution, Nov 2024</div>
                    </div>

                    <div class="voice-card">
                        <div class="voice-header">
                            <div class="voice-avatar">MM</div>
                            <div>
                                <div class="voice-name">Mumbai Migrant</div>
                                <div class="voice-handle">Relocated from Delhi</div>
                            </div>
                            <span class="voice-source">Survey</span>
                        </div>
                        <div class="voice-content">
                            "I took a 30% pay cut to move to Mumbai. My daughter's asthma attacks in Delhi were every week. Here, she's had one in 6 months. The pay cut was worth my child's health. Delhi is unlivable 4 months a year."
                        </div>
                        <div class="voice-meta">Air Quality Migration Survey, IIT-D, 2024</div>
                    </div>
                </div>
            </div>

            <div class="card mt-2">
                <div class="card-header"><span class="card-title">Viral Moments & Public Pressure</span></div>
                <div class="card-body">
                    <div class="grid-3">
                        <div class="info-box">
                            <h4>#DelhiChokes Trends</h4>
                            <p>Hashtag trends nationally every November since 2016. Peak: 2.3M tweets in 48 hours (Nov 2023). Forces government response.</p>
                        </div>
                        <div class="info-box">
                            <h4>Foreign Headlines</h4>
                            <p>"World's Most Polluted Capital" - BBC, Guardian, NYT headlines embarrass government into action during GRAP Stage IV.</p>
                        </div>
                        <div class="info-box">
                            <h4>Meme Culture</h4>
                            <p>"Delhi se hoon bc, oxygen cylinder leke ghumta hoon" memes force conversations. Dark humor as coping mechanism.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== TOOLS ========== -->
        <div class="panel" id="panel-tools">
            <div class="section-intro">
                <h2>Tools & Utilities</h2>
                <p>Tools for researchers, journalists, developers, and citizens to access, embed, and analyze air quality data.</p>
            </div>

            <div class="grid-2 mb-2">
                <div class="tool-card">
                    <div class="tool-header">
                        <h3><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg> Embeddable Widget</h3>
                        <p>Display live AQI on your website, blog, or app.</p>
                        <div class="tool-meta">
                            <div class="tool-meta-item">Auto-updates</div>
                            <div class="tool-meta-item">For: Bloggers, Schools, NGOs</div>
                        </div>
                    </div>
                    <div class="tool-body">
                        <div class="form-group">
                            <label class="form-label">City</label>
                            <select class="form-select" id="widget-city">
                                <option value="delhi">Delhi</option>
                                <option value="mumbai">Mumbai</option>
                                <option value="kolkata">Kolkata</option>
                                <option value="chennai">Chennai</option>
                                <option value="bangalore">Bengaluru</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Size</label>
                            <select class="form-select" id="widget-size">
                                <option value="small">Small (200x100)</option>
                                <option value="medium">Medium (300x150)</option>
                                <option value="large">Large (400x200)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="generateWidget()">Generate Code</button>
                        <div class="code-box mt-2" id="widget-code" style="display: none;"></div>
                    </div>
                </div>

                <div class="tool-card">
                    <div class="tool-header">
                        <h3><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Data Export</h3>
                        <p>Download current AQI data for research and analysis.</p>
                        <div class="tool-meta">
                            <div class="tool-meta-item">JSON, CSV formats</div>
                            <div class="tool-meta-item">For: Researchers, Journalists</div>
                        </div>
                    </div>
                    <div class="tool-body">
                        <p style="font-size: 0.75rem; color: var(--text-2); margin-bottom: 1rem;">Includes: City, AQI, PM2.5, PM10, station, timestamp.</p>
                        <button class="btn btn-primary mb-1" onclick="exportData('json')" style="width: 100%;">Download JSON</button>
                        <button class="btn btn-primary mb-1" onclick="exportData('csv')" style="width: 100%;">Download CSV</button>
                        <button class="btn btn-primary" onclick="exportData('api')" style="width: 100%;">API Info</button>
                    </div>
                </div>
            </div>

            <div class="tool-card">
                <div class="tool-header">
                    <h3><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg> PM2.5 to AQI Converter</h3>
                    <p>Convert raw PM2.5 (ug/m3) to India NAQI and US EPA AQI scales.</p>
                </div>
                <div class="tool-body">
                    <div class="grid-3">
                        <div class="form-group">
                            <label class="form-label">PM2.5 (ug/m3)</label>
                            <input type="number" class="form-input" id="pm25-input" placeholder="e.g., 150">
                        </div>
                        <div class="form-group">
                            <label class="form-label">India AQI (NAQI)</label>
                            <input type="text" class="form-input" id="india-aqi-output" readonly placeholder="--">
                        </div>
                        <div class="form-group">
                            <label class="form-label">US AQI (EPA)</label>
                            <input type="text" class="form-input" id="us-aqi-output" readonly placeholder="--">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="convertPM25()">Convert</button>
                </div>
            </div>
        </div>

        <!-- ========== RESOURCES ========== -->
        <div class="panel" id="panel-resources">
            <div class="section-intro">
                <h2>Research & Resources Library</h2>
                <p>Curated, verified open-access resources from peer-reviewed studies, government portals, and data sources.</p>
            </div>

            <!-- SEARCH -->
            <div class="search-box">
                <input type="text" class="search-input" id="resource-search" placeholder="Search resources (e.g., 'lancet', 'source apportionment', 'NCAP')..." oninput="filterResources()">
                <button class="search-btn" onclick="filterResources()">Search</button>
            </div>

            <div id="resources-container">
                <div class="grid-2 mb-2">
                    <!-- HEALTH STUDIES -->
                    <div class="card">
                        <div class="card-header"><span class="card-title">Health Studies</span></div>
                        <div class="card-body resource-list" data-category="health">
                            <div class="resource-card" data-keywords="lancet gbd mortality deaths india state">
                                <a href="https://www.thelancet.com/journals/lanplh/article/PIIS2542-5196(20)30298-9/fulltext" target="_blank">
                                    <div class="resource-type">Peer-reviewed <span class="badge badge-success">Open Access</span></div>
                                    <div class="resource-title">Lancet GBD 2019: India State-Level Analysis</div>
                                    <div class="resource-desc">Comprehensive state-by-state mortality estimates from air pollution. 2.1M deaths/year attributed to PM2.5.</div>
                                    <div class="resource-meta">Lancet Planetary Health | 2020 | DOI: 10.1016/S2542-5196(20)30298-9</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="state global air 2024 ihme health effects">
                                <a href="https://www.stateofglobalair.org/resources" target="_blank">
                                    <div class="resource-type">Annual Report <span class="badge badge-success">Open Access</span></div>
                                    <div class="resource-title">State of Global Air 2024</div>
                                    <div class="resource-desc">Global air quality trends with India-specific findings. Interactive data explorer available.</div>
                                    <div class="resource-meta">Health Effects Institute | June 2024</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="who guidelines pm2.5 standards">
                                <a href="https://www.who.int/publications/i/item/9789240034228" target="_blank">
                                    <div class="resource-type">Guidelines <span class="badge badge-success">Open Access</span></div>
                                    <div class="resource-title">WHO Air Quality Guidelines 2021</div>
                                    <div class="resource-desc">Updated global guidelines. India is 20x over safe PM2.5 annual limit of 5 ug/m3.</div>
                                    <div class="resource-meta">World Health Organization | 2021</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="ihme gbd interactive data tool">
                                <a href="https://vizhub.healthdata.org/gbd-results/" target="_blank">
                                    <div class="resource-type">Interactive Tool <span class="badge badge-success">Open Access</span></div>
                                    <div class="resource-title">IHME GBD Results Tool</div>
                                    <div class="resource-desc">Query mortality and DALYs by country, state, risk factor. Download custom datasets.</div>
                                    <div class="resource-meta">Institute for Health Metrics and Evaluation</div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- SOURCE APPORTIONMENT -->
                    <div class="card">
                        <div class="card-header"><span class="card-title">Source Apportionment</span></div>
                        <div class="card-body resource-list" data-category="source">
                            <div class="resource-card" data-keywords="teri arai source apportionment delhi ncr vehicles industry">
                                <a href="https://www.teriin.org/sites/default/files/2018-08/Report_SA_AQM-Delhi-NCR_0.pdf" target="_blank">
                                    <div class="resource-type">Technical Report <span class="badge badge-success">Open Access PDF</span></div>
                                    <div class="resource-title">TERI-ARAI Delhi NCR Source Study</div>
                                    <div class="resource-desc">Detailed breakdown: vehicles (28%), industry (30%), dust (18%), biomass (12%).</div>
                                    <div class="resource-meta">TERI & ARAI | 2018</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="urban emissions sarath guttikunda delhi history 1990">
                                <a href="https://urbanemissions.info/" target="_blank">
                                    <div class="resource-type">Research Portal <span class="badge badge-success">Open Access</span></div>
                                    <div class="resource-title">Urban Emissions Info</div>
                                    <div class="resource-desc">Dr. Sarath Guttikunda's comprehensive Delhi air quality research spanning 1990-2023.</div>
                                    <div class="resource-meta">urbanemissions.info | Updated regularly</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="cse vehicles transport emissions analysis">
                                <a href="https://www.cseindia.org/page/programme-air-pollution" target="_blank">
                                    <div class="resource-type">NGO Research <span class="badge badge-success">Open Access</span></div>
                                    <div class="resource-title">CSE Air Pollution Programme</div>
                                    <div class="resource-desc">Centre for Science and Environment's vehicle emissions and transport analysis.</div>
                                    <div class="resource-meta">cseindia.org</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="iit kanpur source apportionment 2016">
                                <a href="http://www.cpcb.nic.in/Delhi.pdf" target="_blank">
                                    <div class="resource-type">Government Report <span class="badge badge-success">Open Access PDF</span></div>
                                    <div class="resource-title">IIT Kanpur Source Apportionment Study</div>
                                    <div class="resource-desc">Landmark 2016 study commissioned by DPCC. Basis for many policy interventions.</div>
                                    <div class="resource-meta">IIT Kanpur for CPCB | 2016</div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- POLICY & LEGAL -->
                    <div class="card">
                        <div class="card-header"><span class="card-title">Policy & Legal</span></div>
                        <div class="card-body resource-list" data-category="policy">
                            <div class="resource-card" data-keywords="caqm grap orders delhi ncr commission">
                                <a href="https://caqm.nic.in/" target="_blank">
                                    <div class="resource-type">Government Portal <span class="badge badge-info">Official</span></div>
                                    <div class="resource-title">CAQM Official Portal</div>
                                    <div class="resource-desc">Commission for Air Quality Management. GRAP orders, meeting minutes, action reports.</div>
                                    <div class="resource-meta">caqm.nic.in</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="ncap prana fund utilization tracker cities">
                                <a href="https://prana.cpcb.gov.in/" target="_blank">
                                    <div class="resource-type">Dashboard <span class="badge badge-info">Official</span></div>
                                    <div class="resource-title">PRANA Portal (NCAP Tracker)</div>
                                    <div class="resource-desc">National Clean Air Programme fund allocation and utilization for 131 cities.</div>
                                    <div class="resource-meta">prana.cpcb.gov.in</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="ngt green tribunal court orders judgments">
                                <a href="https://greentribunal.gov.in/orders" target="_blank">
                                    <div class="resource-type">Legal Database <span class="badge badge-info">Official</span></div>
                                    <div class="resource-title">National Green Tribunal Orders</div>
                                    <div class="resource-desc">All NGT orders searchable by date, state, subject. Key air pollution judgments.</div>
                                    <div class="resource-meta">greentribunal.gov.in</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="indian kanoon supreme court cases pollution">
                                <a href="https://indiankanoon.org/search/?formInput=air%20pollution" target="_blank">
                                    <div class="resource-type">Legal Database <span class="badge badge-success">Open Access</span></div>
                                    <div class="resource-title">Indian Kanoon: Air Pollution Cases</div>
                                    <div class="resource-desc">Searchable database of SC, HC, and NGT judgments on air quality.</div>
                                    <div class="resource-meta">indiankanoon.org</div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- LIVE DATA -->
                    <div class="card">
                        <div class="card-header"><span class="card-title">Live Data Sources</span></div>
                        <div class="card-body resource-list" data-category="data">
                            <div class="resource-card" data-keywords="waqi aqicn live aqi api worldwide">
                                <a href="https://aqicn.org/city/delhi/" target="_blank">
                                    <div class="resource-type">Real-time <span class="badge badge-success">Free API</span></div>
                                    <div class="resource-title">World Air Quality Index (WAQI)</div>
                                    <div class="resource-desc">Primary data source for this dashboard. Free API available for developers.</div>
                                    <div class="resource-meta">aqicn.org | API: api.waqi.info</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="cpcb caaqms official government monitoring">
                                <a href="https://app.cpcbccr.com/ccr/#/caaqm-dashboard-all/caaqm-landing" target="_blank">
                                    <div class="resource-type">Government Dashboard <span class="badge badge-info">Official</span></div>
                                    <div class="resource-title">CPCB CAAQMS Dashboard</div>
                                    <div class="resource-desc">Official continuous ambient air quality monitoring. All CPCB/SPCB stations.</div>
                                    <div class="resource-meta">app.cpcbccr.com</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="safar forecast iitm pune prediction">
                                <a href="https://safar.tropmet.res.in/" target="_blank">
                                    <div class="resource-type">Forecast <span class="badge badge-info">Official</span></div>
                                    <div class="resource-title">SAFAR (IITM Pune)</div>
                                    <div class="resource-desc">System of Air Quality and Weather Forecasting. 3-day AQI predictions.</div>
                                    <div class="resource-meta">safar.tropmet.res.in</div>
                                </a>
                            </div>

                            <div class="resource-card" data-keywords="openaq open air quality global data">
                                <a href="https://openaq.org/locations?country=IN" target="_blank">
                                    <div class="resource-type">Data Platform <span class="badge badge-success">Open Access</span></div>
                                    <div class="resource-title">OpenAQ India</div>
                                    <div class="resource-desc">Aggregates data from multiple sources. Downloadable historical data. API available.</div>
                                    <div class="resource-meta">openaq.org | Free API</div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== ABOUT ========== -->
        <div class="panel" id="panel-about">
            <div class="section-intro" style="background: linear-gradient(135deg, rgba(124,58,237,0.08), rgba(167,139,250,0.05)); border-color: rgba(124,58,237,0.2);">
                <h2 style="font-size: 1.25rem;">About Vayu Smriti वायु स्मृति</h2>
                <p style="font-size: 0.875rem;"><strong>Vayu Smriti</strong> (Air Memory) is a citizen-led, open-source air quality archive for India. It exists because air pollution is not just an environmental issue — it is a public health emergency, an economic drain, and a failure of governance that demands transparency and accountability.</p>
            </div>

            <div class="grid-2 mb-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">Why Vayu Smriti Exists</span></div>
                    <div class="card-body" style="font-size: 0.8125rem; line-height: 1.7;">
                        <p><strong>The Problem:</strong> India has the world's worst air quality. Delhi regularly exceeds WHO safe limits by 20-40x. Over 2 million Indians die annually from air pollution — more than malaria, TB, and HIV combined. Yet public discourse remains fragmented, data is scattered, and accountability is absent.</p>
                        <p class="mt-2"><strong>The Gap:</strong> Official dashboards show data but don't translate it into health risks. Research papers exist but aren't accessible to citizens. Politicians make promises but no one tracks outcomes. RTI is powerful but intimidating for most citizens.</p>
                        <p class="mt-2"><strong>Our Response:</strong> Vayu Smriti bridges these gaps by integrating live data, health science, economic analysis, and accountability tools into a single, accessible platform — designed for citizens, journalists, researchers, and advocates.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">Our Principles</span></div>
                    <div class="card-body">
                        <div class="info-box mb-1" style="border-left: 3px solid #10B981;">
                            <h4 style="color: #10B981;">Open & Transparent</h4>
                            <p style="font-size: 0.75rem;">All code is open-source. All data sources are cited. All methodologies are documented. No hidden agendas.</p>
                        </div>
                        <div class="info-box mb-1" style="border-left: 3px solid #3B82F6;">
                            <h4 style="color: #3B82F6;">Evidence-Based</h4>
                            <p style="font-size: 0.75rem;">We use peer-reviewed research (Lancet GBD, WHO, IHME) and established methodologies (GEMM, World Bank). No speculation.</p>
                        </div>
                        <div class="info-box mb-1" style="border-left: 3px solid #F59E0B;">
                            <h4 style="color: #F59E0B;">Citizen-Centered</h4>
                            <p style="font-size: 0.75rem;">Designed for ordinary citizens, not just experts. Translates complex data into actionable insights and empowerment tools.</p>
                        </div>
                        <div class="info-box" style="border-left: 3px solid #EF4444;">
                            <h4 style="color: #EF4444;">Accountability-Focused</h4>
                            <p style="font-size: 0.75rem;">We track political promises, grade policy effectiveness, and provide RTI templates because change requires pressure.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- UNIQUE CONTRIBUTIONS -->
            <div class="card mb-2" style="border: 2px solid var(--primary);">
                <div class="card-header" style="background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(167,139,250,0.05));">
                    <span class="card-title" style="color: var(--primary);">
                        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                        What Makes Vayu Smriti Unique
                    </span>
                </div>
                <div class="card-body">
                    <p style="font-size: 0.8125rem; color: var(--text-2); margin-bottom: 1rem;">
                        Vayu Smriti is not just an aggregator — it provides unique value through integration, analysis, and citizen empowerment tools not available elsewhere.
                    </p>
                    <div class="grid-3">
                        <div class="info-box" style="border-left: 3px solid #EF4444;">
                            <h4 style="color: #EF4444;">Health Impact Tools</h4>
                            <ul style="margin-left: 0; padding-left: 1rem; font-size: 0.75rem;">
                                <li><strong>Personal Risk Calculator</strong> — GEMM-based mortality risk by age, exposure, conditions</li>
                                <li><strong>Safe Outdoor Hours</strong> — Activity-adjusted exposure limits</li>
                                <li><strong>Cigarette Equivalence</strong> — Berkeley Earth methodology</li>
                            </ul>
                        </div>
                        <div class="info-box" style="border-left: 3px solid #F59E0B;">
                            <h4 style="color: #F59E0B;">Economic Analysis</h4>
                            <ul style="margin-left: 0; padding-left: 1rem; font-size: 0.75rem;">
                                <li><strong>Business Loss Calculator</strong> — World Bank methodology for productivity</li>
                                <li><strong>City-specific Estimates</strong> — Localized economic impact by AQI</li>
                                <li><strong>Sector Breakdown</strong> — Healthcare, agriculture, deaths cost</li>
                            </ul>
                        </div>
                        <div class="info-box" style="border-left: 3px solid #3B82F6;">
                            <h4 style="color: #3B82F6;">Accountability</h4>
                            <ul style="margin-left: 0; padding-left: 1rem; font-size: 0.75rem;">
                                <li><strong>RTI Templates</strong> — Ready-to-file with addresses</li>
                                <li><strong>Promise Tracker</strong> — Political statements vs outcomes</li>
                                <li><strong>Policy Scorecard</strong> — Evidence-graded effectiveness</li>
                            </ul>
                        </div>
                    </div>
                    <div class="grid-2 mt-2">
                        <div class="info-box" style="border-left: 3px solid #10B981;">
                            <h4 style="color: #10B981;">Live Data Integration</h4>
                            <ul style="margin-left: 0; padding-left: 1rem; font-size: 0.75rem;">
                                <li><strong>20+ City Ticker</strong> — Real-time WAQI data, auto-refreshes every 10 minutes</li>
                                <li><strong>Interactive Map</strong> — Click for PM2.5, station name, timestamp</li>
                                <li><strong>City Comparison</strong> — India vs international benchmarks (live)</li>
                                <li><strong>Data Export</strong> — JSON/CSV download for researchers</li>
                            </ul>
                        </div>
                        <div class="info-box" style="border-left: 3px solid #7C3AED;">
                            <h4 style="color: #7C3AED;">Citizen Empowerment</h4>
                            <ul style="margin-left: 0; padding-left: 1rem; font-size: 0.75rem;">
                                <li><strong>Citizen Voices</strong> — Curated testimonies from affected communities</li>
                                <li><strong>Embeddable Widgets</strong> — For schools, NGOs, blogs</li>
                                <li><strong>Curated Resources</strong> — Verified open-access links only</li>
                                <li><strong>Dark Mode</strong> — Accessibility for all users</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid-2 mb-2">
                <div class="card">
                    <div class="card-header"><span class="card-title">Data Sources & Methodology</span></div>
                    <div class="card-body" style="font-size: 0.75rem;">
                        <div class="table-wrap">
                            <table class="table">
                                <thead><tr><th>Component</th><th>Source</th><th>Update Frequency</th></tr></thead>
                                <tbody>
                                    <tr><td>Live AQI Data</td><td>WAQI API (aqicn.org)</td><td>Every 10 minutes</td></tr>
                                    <tr><td>Health Risk Model</td><td>GEMM (Lancet GBD 2019)</td><td>Static methodology</td></tr>
                                    <tr><td>Economic Loss</td><td>World Bank / OECD</td><td>Annual estimates</td></tr>
                                    <tr><td>Mortality Data</td><td>IHME / Lancet</td><td>Annual updates</td></tr>
                                    <tr><td>Policy Tracker</td><td>CAQM, NGT, News</td><td>Manual curation</td></tr>
                                    <tr><td>Citizen Voices</td><td>Social media, interviews</td><td>Manual curation</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">Limitations & Disclaimers</span></div>
                    <div class="card-body" style="font-size: 0.75rem; line-height: 1.6;">
                        <p><strong>Not Medical Advice:</strong> Health risk calculators provide estimates based on population-level research. Individual risk varies. Consult healthcare providers for personal medical decisions.</p>
                        <p class="mt-1"><strong>Data Accuracy:</strong> Live AQI depends on WAQI API and underlying monitoring station reliability. Some stations may have gaps or calibration issues.</p>
                        <p class="mt-1"><strong>Economic Estimates:</strong> Productivity loss calculations use simplified models. Actual business impact depends on many factors not captured here.</p>
                        <p class="mt-1"><strong>Open Source:</strong> This is a volunteer project. We welcome corrections, contributions, and feedback via GitHub.</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><span class="card-title">Get Involved</span></div>
                <div class="card-body">
                    <div class="grid-4">
                        <a href="https://github.com/Varnasr/vayu-smriti" target="_blank" class="quick-link" style="text-decoration: none;">
                            <div class="quick-link-icon" style="background: #1F2937;"><svg viewBox="0 0 24 24" fill="white"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg></div>
                            <div class="quick-link-content"><h4>Contribute Code</h4><p>Fork on GitHub</p></div>
                        </a>
                        <a href="https://twitter.com/intent/tweet?text=Check%20out%20Vayu%20Smriti%20-%20India's%20citizen-led%20air%20quality%20archive&url=https://varnasr.github.io/vayu-smriti" target="_blank" class="quick-link" style="text-decoration: none;">
                            <div class="quick-link-icon" style="background: #1DA1F2;"><svg viewBox="0 0 24 24" fill="white"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></div>
                            <div class="quick-link-content"><h4>Share</h4><p>Spread the word</p></div>
                        </a>
                        <a href="mailto:varna.sr@gmail.com?subject=Vayu%20Smriti%20Feedback" class="quick-link" style="text-decoration: none;">
                            <div class="quick-link-icon" style="background: var(--primary);"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
                            <div class="quick-link-content"><h4>Feedback</h4><p>Report issues</p></div>
                        </a>
                        <a href="https://rtionline.gov.in" target="_blank" class="quick-link" style="text-decoration: none;">
                            <div class="quick-link-icon" style="background: #EF4444;"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
                            <div class="quick-link-content"><h4>File RTI</h4><p>Demand accountability</p></div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>Vayu Smriti — Citizen-led air quality archive | <a href="https://github.com/Varnasr/vayu-smriti" style="color: var(--primary);">GitHub</a></p>
        <p style="font-size: 0.625rem; margin-top: 0.25rem; color: var(--text-3);">Data: WAQI, CPCB, WHO, Lancet, IHME | Not for medical diagnosis</p>
    </footer>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        // Using WAQI public token for live data - get your own at https://aqicn.org/data-platform/token/
        const WAQI_TOKEN = '0e7fce65a48fe0e93d81a5cb330a15a86e06e1b0';
        
        const CITIES = {
            delhi: { name: 'Delhi', lat: 28.6139, lon: 77.2090, query: 'delhi', region: 'north' },
            mumbai: { name: 'Mumbai', lat: 19.0760, lon: 72.8777, query: 'mumbai', region: 'west' },
            kolkata: { name: 'Kolkata', lat: 22.5726, lon: 88.3639, query: 'kolkata', region: 'east' },
            chennai: { name: 'Chennai', lat: 13.0827, lon: 80.2707, query: 'chennai', region: 'south' },
            bangalore: { name: 'Bengaluru', lat: 12.9716, lon: 77.5946, query: 'bangalore', region: 'south' },
            hyderabad: { name: 'Hyderabad', lat: 17.3850, lon: 78.4867, query: 'hyderabad', region: 'south' },
            gurgaon: { name: 'Gurgaon', lat: 28.4595, lon: 77.0266, query: 'gurgaon', region: 'north' },
            noida: { name: 'Noida', lat: 28.5355, lon: 77.3910, query: 'noida', region: 'north' },
            faridabad: { name: 'Faridabad', lat: 28.4089, lon: 77.3178, query: 'faridabad', region: 'north' },
            ghaziabad: { name: 'Ghaziabad', lat: 28.6692, lon: 77.4538, query: 'ghaziabad', region: 'north' },
            lucknow: { name: 'Lucknow', lat: 26.8467, lon: 80.9462, query: 'lucknow', region: 'north' },
            kanpur: { name: 'Kanpur', lat: 26.4499, lon: 80.3319, query: 'kanpur', region: 'north' },
            patna: { name: 'Patna', lat: 25.5941, lon: 85.1376, query: 'patna', region: 'north' },
            jaipur: { name: 'Jaipur', lat: 26.9124, lon: 75.7873, query: 'jaipur', region: 'north' },
            ahmedabad: { name: 'Ahmedabad', lat: 23.0225, lon: 72.5714, query: 'ahmedabad', region: 'west' },
            pune: { name: 'Pune', lat: 18.5204, lon: 73.8567, query: 'pune', region: 'west' },
            beijing: { name: 'Beijing', lat: 39.9042, lon: 116.4074, query: 'beijing', region: 'intl' },
            london: { name: 'London', lat: 51.5074, lon: -0.1278, query: 'london', region: 'intl' },
            singapore: { name: 'Singapore', lat: 1.3521, lon: 103.8198, query: 'singapore', region: 'intl' }
        };

        const INDIAN_CITIES = Object.keys(CITIES).filter(k => CITIES[k].region !== 'intl');
        let aqiData = {};
        let charts = {};
        let map = null;

        // ============================================
        // THEME
        // ============================================
        function toggleTheme() {
            const html = document.documentElement;
            html.setAttribute('data-theme', html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
            initAllCharts();
        }

        // ============================================
        // NAVIGATION
        // ============================================
        function showPanel(panel) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('panel-' + panel).classList.add('active');
            document.querySelectorAll('.tab').forEach(t => {
                if (t.textContent.toLowerCase().trim().startsWith(panel.substring(0, 4))) t.classList.add('active');
            });
            
            // Trigger specific panel actions
            if (panel === 'map') {
                initMap();
                if (map) setTimeout(() => map.invalidateSize(), 100);
            }
            if (panel === 'compare') {
                // Always fetch fresh data when opening compare tab
                updateComparison(true);
            }
        }

        // ============================================
        // AQI UTILITIES
        // ============================================
        function getAQIClass(aqi) {
            if (aqi <= 50) return 'good';
            if (aqi <= 100) return 'mod';
            if (aqi <= 200) return 'poor';
            if (aqi <= 300) return 'vpoor';
            if (aqi <= 400) return 'severe';
            return 'hazard';
        }

        function getAQIColor(aqi) {
            if (aqi <= 50) return '#22C55E';
            if (aqi <= 100) return '#EAB308';
            if (aqi <= 200) return '#F97316';
            if (aqi <= 300) return '#EF4444';
            if (aqi <= 400) return '#7C3AED';
            return '#831843';
        }

        function getAQILabel(aqi) {
            if (aqi <= 50) return 'Good';
            if (aqi <= 100) return 'Moderate';
            if (aqi <= 200) return 'Poor';
            if (aqi <= 300) return 'Very Poor';
            if (aqi <= 400) return 'Severe';
            return 'Hazardous';
        }

        // ============================================
        // DATA FETCH
        // ============================================
        async function fetchAQI(cityKey) {
            try {
                const city = CITIES[cityKey];
                const res = await fetch(`https://api.waqi.info/feed/${city.query}/?token=${WAQI_TOKEN}`);
                const data = await res.json();
                if (data.status === 'ok' && data.data.aqi !== '-') {
                    return { aqi: parseInt(data.data.aqi), pm25: data.data.iaqi?.pm25?.v || null, pm10: data.data.iaqi?.pm10?.v || null, time: data.data.time?.s, station: data.data.city?.name };
                }
            } catch (e) { console.warn(`Failed: ${cityKey}`); }
            return null;
        }

        async function fetchAllAQI() {
            const ticker = document.getElementById('aqi-ticker');
            ticker.innerHTML = '<div class="ticker-item"><span class="ticker-city">Fetching live data...</span></div>';
            
            // Fetch all Indian cities
            const results = await Promise.all(INDIAN_CITIES.map(c => fetchAQI(c)));
            results.forEach((r, i) => { if (r) aqiData[INDIAN_CITIES[i]] = r; });
            
            // Update all components
            updateTicker();
            updateDashboard();
            initAllCharts();
            
            // Update map if it exists
            if (map) updateMapMarkers();
            
            // Update timestamp
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('ticker-update').textContent = timeStr;
            
            // Update live status indicator
            const liveStatus = document.getElementById('live-status');
            if (liveStatus) {
                liveStatus.innerHTML = `<span class="pulse"></span> LIVE — Last refresh: ${timeStr}`;
            }
            
            console.log(`[Vayu Smriti] Fetched ${Object.keys(aqiData).length} cities at ${now.toISOString()}`);
        }

        function updateTicker() {
            const ticker = document.getElementById('aqi-ticker');
            ticker.innerHTML = Object.entries(aqiData).sort((a, b) => b[1].aqi - a[1].aqi).map(([key, data]) => 
                `<div class="ticker-item"><span class="ticker-city">${CITIES[key]?.name || key}</span><span class="ticker-aqi ${getAQIClass(data.aqi)}">${data.aqi}</span></div>`
            ).join('');
        }

        function updateDashboard() {
            if (aqiData.delhi) {
                document.getElementById('delhi-live-aqi').textContent = aqiData.delhi.aqi;
                document.getElementById('delhi-live-aqi').className = 'stat-value ' + (aqiData.delhi.aqi > 200 ? 'danger' : aqiData.delhi.aqi > 100 ? 'warning' : 'success');
                document.getElementById('delhi-aqi-status').textContent = getAQILabel(aqiData.delhi.aqi);
            }
            const sorted = Object.entries(aqiData).sort((a, b) => b[1].aqi - a[1].aqi);
            if (sorted.length > 0) {
                document.getElementById('worst-city-aqi').textContent = sorted[0][1].aqi;
                document.getElementById('worst-city-aqi').className = 'stat-value danger';
                document.getElementById('worst-city-name').textContent = CITIES[sorted[0][0]]?.name || sorted[0][0];
            }
            document.getElementById('worst-cities').innerHTML = sorted.slice(0, 5).map((item, i) => `<div class="city-rank"><span class="rank-num ${i < 3 ? 'top' : ''}">${i + 1}</span><span class="city-rank-name">${CITIES[item[0]]?.name || item[0]}</span><span class="city-rank-aqi" style="background: ${getAQIColor(item[1].aqi)}">${item[1].aqi}</span></div>`).join('');
            document.getElementById('best-cities').innerHTML = sorted.slice(-5).reverse().map((item, i) => `<div class="city-rank"><span class="rank-num">${i + 1}</span><span class="city-rank-name">${CITIES[item[0]]?.name || item[0]}</span><span class="city-rank-aqi" style="background: ${getAQIColor(item[1].aqi)}">${item[1].aqi}</span></div>`).join('');
            loadDashboardNews();
        }

        function loadDashboardNews() {
            document.getElementById('dashboard-news').innerHTML = `
                <div class="news-item" style="padding: 0.5rem 0;"><div class="news-meta"><span class="news-source">SC</span>Nov 2024</div><div class="news-title" style="font-size: 0.75rem;">SC slams governments over inaction</div></div>
                <div class="news-item" style="padding: 0.5rem 0;"><div class="news-meta"><span class="news-source">CAQM</span>Dec 2024</div><div class="news-title" style="font-size: 0.75rem;">GRAP Stage IV extended</div></div>
                <div class="news-item" style="padding: 0.5rem 0;"><div class="news-meta"><span class="news-source">Study</span>2024</div><div class="news-title" style="font-size: 0.75rem;">Smog towers found ineffective: IIT</div></div>
            `;
        }

        // ============================================
        // CALCULATORS
        // ============================================
        function calculateSafeHours() {
            const aqi = parseInt(document.getElementById('safe-aqi').value);
            const activity = parseFloat(document.getElementById('safe-activity').value);
            const health = parseFloat(document.getElementById('safe-health').value);
            let baseHours = 24;
            if (aqi > 50) baseHours = Math.max(0.5, 12 - ((aqi - 50) / 30));
            if (aqi > 200) baseHours = Math.max(0.25, 4 - ((aqi - 200) / 100));
            if (aqi > 400) baseHours = 0;
            const adjustedHours = Math.max(0, baseHours / (activity * health));
            document.getElementById('safe-result').style.display = 'block';
            document.getElementById('safe-hours').textContent = adjustedHours === 0 ? 'AVOID OUTDOORS' : adjustedHours.toFixed(1) + ' hours';
            document.getElementById('safe-hours').style.color = adjustedHours < 2 ? '#EF4444' : adjustedHours < 4 ? '#F59E0B' : '#22C55E';
            document.getElementById('safe-advice').textContent = aqi > 300 ? 'Severe. Stay indoors. N95 if unavoidable.' : aqi > 200 ? 'Very poor. Avoid outdoor exercise.' : 'Reduce prolonged exertion.';
        }

        function calculateHealthRisk() {
            const age = parseInt(document.getElementById('health-age').value);
            const pm25 = parseFloat(document.getElementById('health-pm25').value);
            const outdoor = parseFloat(document.getElementById('health-outdoor').value);
            const conditions = parseFloat(document.getElementById('health-conditions').value);
            const baselineRisk = Math.exp(0.1 * Math.log(1 + 5/2.5));
            const currentRisk = Math.exp(0.1 * Math.log(1 + pm25/2.5));
            const excessRisk = ((currentRisk / baselineRisk) - 1) * 100 * conditions * (outdoor / 8);
            const yearsLost = (excessRisk / 100) * (75 - age) * 0.3;
            const cigarettes = (pm25 * outdoor / 24) / 22;
            document.getElementById('mortality-risk').textContent = '+' + excessRisk.toFixed(1) + '%';
            document.getElementById('life-years-lost').textContent = yearsLost.toFixed(1) + ' years';
            document.getElementById('cigarette-equiv').textContent = cigarettes.toFixed(1) + ' cig/day';
        }

        document.getElementById('health-outdoor')?.addEventListener('input', e => {
            document.getElementById('outdoor-display').textContent = e.target.value;
        });

        function calculateEconomicLoss() {
            const employees = parseInt(document.getElementById('econ-employees').value);
            const salary = parseInt(document.getElementById('econ-salary').value);
            const cityKey = document.getElementById('econ-city').value;
            const cityAQI = aqiData[cityKey]?.aqi || 150;
            const productivityLoss = Math.max(0, (cityAQI - 50) / 10) * 0.01;
            const annualLoss = salary * 12 * employees * productivityLoss;
            document.getElementById('econ-result').style.display = 'block';
            document.getElementById('econ-loss').textContent = 'Rs ' + (annualLoss / 100000).toFixed(1) + ' Lakhs/year';
            document.getElementById('econ-detail').innerHTML = `Productivity loss: ${(productivityLoss * 100).toFixed(1)}%<br>Based on ${CITIES[cityKey]?.name} AQI: ${cityAQI}`;
        }

        // ============================================
        // COMPARISON - FIXED TO FETCH LIVE DATA
        // ============================================
        async function updateComparison(forceRefresh = false) {
            const cities = [
                document.getElementById('compare-city1').value, 
                document.getElementById('compare-city2').value, 
                document.getElementById('compare-city3').value
            ];
            
            // Show loading state
            document.getElementById('comparison-result').innerHTML = cities.map(c => 
                `<div class="card stat-card"><div style="font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem;">${CITIES[c]?.name || c}</div><div class="stat-value" style="color: var(--text-3);">...</div><div class="stat-label">Fetching live data</div></div>`
            ).join('');
            
            // Always fetch fresh data for international cities, or if forceRefresh
            for (const c of cities) {
                if (forceRefresh || !aqiData[c] || CITIES[c]?.region === 'intl') {
                    const d = await fetchAQI(c);
                    if (d) aqiData[c] = d;
                }
            }
            
            // Update timestamp
            const updateTimeEl = document.getElementById('compare-update-time');
            if (updateTimeEl) {
                updateTimeEl.textContent = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
            }
            
            // Render comparison cards with live data
            document.getElementById('comparison-result').innerHTML = cities.map(c => {
                const data = aqiData[c];
                const aqi = data?.aqi || '--';
                const label = data ? getAQILabel(data.aqi) : 'No data';
                const color = data ? getAQIColor(data.aqi) : 'var(--text-3)';
                const pm25 = data?.pm25 ? `PM2.5: ${data.pm25}` : '';
                return `<div class="card stat-card">
                    <div style="font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem;">${CITIES[c]?.name || c}</div>
                    <div class="stat-value" style="color: ${color}">${aqi}</div>
                    <div class="stat-label">${label}</div>
                    <div style="font-size: 0.625rem; color: var(--text-3); margin-top: 0.25rem;">${pm25}</div>
                </div>`;
            }).join('');
            
            // Update chart with live data
            if (charts.compare) {
                const aqiValues = cities.map(c => aqiData[c]?.aqi || 0);
                const colors = cities.map(c => getAQIColor(aqiData[c]?.aqi || 0));
                charts.compare.data.labels = cities.map(c => CITIES[c]?.name || c);
                charts.compare.data.datasets[0].data = aqiValues;
                charts.compare.data.datasets[0].backgroundColor = colors;
                charts.compare.update('none');
            }
        }

        // ============================================
        // MAP - NOW WITH LIVE DATA UPDATES
        // ============================================
        let mapMarkers = [];
        
        function initMap() {
            if (map) return; // Don't reinitialize
            map = L.map('india-map').setView([22.5, 78.5], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
                attribution: '© OpenStreetMap | AQI data from WAQI API (Live)' 
            }).addTo(map);
            updateMapMarkers();
        }
        
        function updateMapMarkers() {
            // Clear existing markers
            mapMarkers.forEach(m => map.removeLayer(m));
            mapMarkers = [];
            
            Object.entries(CITIES).forEach(([key, city]) => {
                if (!city.lat || city.region === 'intl') return;
                const data = aqiData[key];
                const aqi = data?.aqi;
                const color = aqi ? getAQIColor(aqi) : '#9CA3AF';
                const label = aqi ? getAQILabel(aqi) : 'No data';
                const pm25Text = data?.pm25 ? `<br>PM2.5: ${data.pm25} μg/m³` : '';
                const timeText = data?.time ? `<br><small>Updated: ${data.time}</small>` : '';
                
                const marker = L.circleMarker([city.lat, city.lon], { 
                    radius: aqi ? Math.min(20, 8 + aqi/50) : 8,
                    fillColor: color, 
                    color: '#fff', 
                    weight: 2, 
                    fillOpacity: 0.85 
                }).addTo(map).bindPopup(`
                    <strong>${city.name}</strong><br>
                    AQI: <span style="color: ${color}; font-weight: bold;">${aqi || '?'}</span> (${label})
                    ${pm25Text}${timeText}
                `);
                mapMarkers.push(marker);
            });
        }

        // ============================================
        // CHARTS
        // ============================================
        function initAllCharts() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const textColor = isDark ? '#94A3B8' : '#64748B';
            const gridColor = isDark ? '#334155' : '#E2E8F0';
            Chart.defaults.color = textColor;
            Object.values(charts).forEach(c => c?.destroy?.());
            charts = {};

            const metroCtx = document.getElementById('metroChart');
            if (metroCtx) {
                const metros = ['delhi', 'mumbai', 'kolkata', 'chennai', 'bangalore', 'hyderabad'];
                charts.metro = new Chart(metroCtx, { type: 'bar', data: { labels: metros.map(c => CITIES[c].name), datasets: [{ data: metros.map(c => aqiData[c]?.aqi || 0), backgroundColor: metros.map(c => getAQIColor(aqiData[c]?.aqi || 0)) }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { max: 500, grid: { color: gridColor } } } } });
            }

            const regionCtx = document.getElementById('regionChart');
            if (regionCtx) {
                const north = ['delhi', 'lucknow', 'patna'].map(c => aqiData[c]?.aqi || 0);
                const south = ['chennai', 'bangalore', 'hyderabad'].map(c => aqiData[c]?.aqi || 0);
                charts.region = new Chart(regionCtx, { type: 'bar', data: { labels: ['North India', 'South India'], datasets: [{ label: 'Average AQI', data: [north.reduce((a, b) => a + b, 0) / north.length, south.reduce((a, b) => a + b, 0) / south.length], backgroundColor: ['#EF4444', '#22C55E'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { max: 400, grid: { color: gridColor } } } } });
            }

            const econCtx = document.getElementById('econChart');
            if (econCtx) {
                charts.econ = new Chart(econCtx, { type: 'doughnut', data: { labels: ['Healthcare', 'Productivity', 'Deaths', 'Agriculture'], datasets: [{ data: [170000, 120000, 95000, 35000], backgroundColor: ['#EF4444', '#F59E0B', '#7C3AED', '#22C55E'] }] }, options: { responsive: true, maintainAspectRatio: false } });
            }

            const ncapCtx = document.getElementById('ncapChart');
            if (ncapCtx) {
                charts.ncap = new Chart(ncapCtx, { type: 'bar', data: { labels: ['Delhi', 'Mumbai', 'Kolkata', 'Chennai', 'Lucknow'], datasets: [{ label: 'Allocated', data: [450, 380, 290, 220, 180], backgroundColor: '#3B82F6' }, { label: 'Utilized', data: [180, 220, 145, 165, 72], backgroundColor: '#22C55E' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: gridColor } } } } });
            }

            const compareCtx = document.getElementById('compareChart');
            if (compareCtx) {
                // Get selected cities for comparison
                const c1 = document.getElementById('compare-city1')?.value || 'delhi';
                const c2 = document.getElementById('compare-city2')?.value || 'mumbai';
                const c3 = document.getElementById('compare-city3')?.value || 'beijing';
                const cities = [c1, c2, c3];
                const labels = cities.map(c => CITIES[c]?.name || c);
                const data = cities.map(c => aqiData[c]?.aqi || 0);
                const colors = cities.map(c => aqiData[c]?.aqi ? getAQIColor(aqiData[c].aqi) : '#ccc');
                
                charts.compare = new Chart(compareCtx, { 
                    type: 'bar', 
                    data: { 
                        labels: labels, 
                        datasets: [{ 
                            label: 'Live AQI',
                            data: data, 
                            backgroundColor: colors 
                        }] 
                    }, 
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        plugins: { legend: { display: false } }, 
                        scales: { y: { max: 500, grid: { color: gridColor } } } 
                    } 
                });
            }

            const historyCtx = document.getElementById('historyChart');
            if (historyCtx) {
                charts.history = new Chart(historyCtx, { type: 'line', data: { labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024', '2025'], datasets: [{ label: 'Delhi PM2.5', data: [122, 134, 128, 115, 108, 84, 96, 99, 102, 105, 100], borderColor: '#7C3AED', backgroundColor: 'rgba(124,58,237,0.1)', fill: true, tension: 0.4 }, { label: 'WHO Guideline', data: [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5], borderColor: '#22C55E', borderDash: [5, 5], fill: false }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { max: 150, grid: { color: gridColor } } } } });
            }

            const seasonalCtx = document.getElementById('seasonalChart');
            if (seasonalCtx) {
                charts.seasonal = new Chart(seasonalCtx, { type: 'line', data: { labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], datasets: [{ label: 'Avg AQI', data: [320, 280, 180, 120, 110, 90, 80, 75, 95, 180, 380, 350], borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { max: 450, grid: { color: gridColor } } } } });
            }
        }

        // ============================================
        // TOOLS
        // ============================================
        function exportData(format) {
            const data = { timestamp: new Date().toISOString(), source: 'Vayu Smriti / WAQI', cities: aqiData };
            if (format === 'json') {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'vayu-smriti-data.json'; a.click();
            } else if (format === 'csv') {
                let csv = 'City,AQI,PM2.5,PM10,Station,Time\n';
                Object.entries(aqiData).forEach(([city, d]) => { csv += `${CITIES[city]?.name || city},${d.aqi},${d.pm25 || ''},${d.pm10 || ''},"${d.station || ''}",${d.time || ''}\n`; });
                const blob = new Blob([csv], { type: 'text/csv' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'vayu-smriti-data.csv'; a.click();
            } else if (format === 'api') {
                alert('WAQI API:\nhttps://api.waqi.info/feed/{city}/?token=YOUR_TOKEN\n\nGet free token:\nhttps://aqicn.org/data-platform/token/');
            }
        }

        function generateWidget() {
            const city = document.getElementById('widget-city').value;
            const size = document.getElementById('widget-size').value;
            const dims = { small: ['200', '100'], medium: ['300', '150'], large: ['400', '200'] };
            document.getElementById('widget-code').style.display = 'block';
            document.getElementById('widget-code').textContent = `<iframe src="https://aqicn.org/city/${city}/" width="${dims[size][0]}" height="${dims[size][1]}" frameborder="0" style="border-radius:8px;"></iframe>`;
        }

        function copyRTI() {
            navigator.clipboard.writeText(document.getElementById('rti-template').textContent);
            alert('RTI template copied!');
        }

        function convertPM25() {
            const pm25 = parseFloat(document.getElementById('pm25-input').value);
            if (isNaN(pm25)) return;
            let indiaAQI, usAQI;
            if (pm25 <= 30) indiaAQI = pm25 * 50 / 30;
            else if (pm25 <= 60) indiaAQI = 50 + (pm25 - 30) * 50 / 30;
            else if (pm25 <= 90) indiaAQI = 100 + (pm25 - 60) * 100 / 30;
            else if (pm25 <= 120) indiaAQI = 200 + (pm25 - 90) * 100 / 30;
            else indiaAQI = 300 + (pm25 - 120) * 100 / 130;
            if (pm25 <= 12) usAQI = pm25 * 50 / 12;
            else if (pm25 <= 35.4) usAQI = 50 + (pm25 - 12) * 50 / 23.4;
            else if (pm25 <= 55.4) usAQI = 100 + (pm25 - 35.4) * 50 / 20;
            else usAQI = 150 + (pm25 - 55.4) * 50 / 95;
            document.getElementById('india-aqi-output').value = Math.round(indiaAQI);
            document.getElementById('us-aqi-output').value = Math.round(usAQI);
        }

        // ============================================
        // RESOURCE SEARCH
        // ============================================
        function filterResources() {
            const query = document.getElementById('resource-search').value.toLowerCase();
            document.querySelectorAll('.resource-card').forEach(card => {
                const keywords = card.getAttribute('data-keywords') || '';
                const title = card.querySelector('.resource-title')?.textContent.toLowerCase() || '';
                const desc = card.querySelector('.resource-desc')?.textContent.toLowerCase() || '';
                const match = keywords.includes(query) || title.includes(query) || desc.includes(query) || query === '';
                card.style.display = match ? 'block' : 'none';
            });
        }

        // ============================================
        // INIT
        // ============================================
        document.addEventListener('DOMContentLoaded', async () => {
            await fetchAllAQI();
            initAllCharts();
            setInterval(fetchAllAQI, 10 * 60 * 1000);
        });
    </script>
</body>
</html>
